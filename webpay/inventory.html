<!DOCTYPE html>
<html lang="en">
<head>‚Ä¶</head>
<body>
  <!-- same layout -->
<script>
// üîà SOUND SUPPORT (same)
let isMuted = false;
function playSuccess(){ if(!isMuted) new Audio('sounds/success.mp3').play(); }
function playError(){ if(!isMuted) new Audio('sounds/error.mp3').play(); }
function toggleMute(btn){ isMuted=!isMuted; btn.textContent = isMuted?'üîá':'üîä'; }

// Fetch from JSON
let db = {};
function loadProducts(){
  fetch('data/products.json')
    .then(r=>r.json())
    .then(json=>{
      db = json;
      renderTable();
    })
    .catch(err=>{
      playError();
      alert('‚ùå Error loading products.json');
      console.error(err);
    });
}

function renderTable(){
  const table = document.getElementById('product-table');
  table.innerHTML = '';
  for(const [barcode, p] of Object.entries(db)){
    const qty = p.qty || 0;
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${barcode}</td>
      <td>${p.name}</td>
      <td>‚Ç±${parseFloat(p.price).toFixed(2)}</td>
      <td>${qty}</td>
      <td>
        <button class="edit-btn" onclick="editProduct('${barcode}')">‚úèÔ∏è</button>
        <button class="del-btn" onclick="deleteProduct('${barcode}')">üóëÔ∏è</button>
      </td>`;
    table.appendChild(row);
  }
}

// Edit and delete must update JSON separately ‚Äì localStorage no longer used
function editProduct(barcode){
  const p = db[barcode];
  const n = prompt('Edit name:', p.name);
  const pr = parseFloat(prompt('Edit price:', p.price));
  const q = parseInt(prompt('Edit qty:', p.qty));
  if(n && !isNaN(pr) && !isNaN(q)){
    db[barcode]={name:n,price:pr,qty:q};
    playSuccess();
    renderTable();
    saveToLocal();
  } else {
    playError();
    alert('‚ö†Ô∏è Invalid input');
  }
}

function deleteProduct(barcode){
  if(!confirm('‚ùå Delete?'))return;
  delete db[barcode];
  playSuccess();
  renderTable();
  saveToLocal();
}

// Export & import can still use JSON files
function exportJSON(){
  const blob = new Blob([JSON.stringify(db,null,2)],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='products.json';
  a.click();
}

function importJSON(e){
  const file=e.target.files[0];
  if(!file)return;
  new FileReader().onload=e=>{
    try{
      db=JSON.parse(e.target.result);
      playSuccess();
      renderTable();
      saveToLocal();
    }catch{
      playError();
      alert('‚ùå Invalid JSON file');
    }
  }.readAsText(file);
}

// Save edited changes locally too if needed
function saveToLocal(){
  localStorage.setItem('products', JSON.stringify(db));
}

// Init
loadProducts();
</script>
</body>
</html>
