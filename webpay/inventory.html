<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BJC Inventory</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h1 { text-align: center; color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
    th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }
    th { background-color: #007bff; color: white; }
    tr:hover { background-color: #f1f1f1; }
    button { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; }
    .del-btn { background: #dc3545; color: white; }
    .edit-btn { background: #ffc107; color: black; }
    #muteBtn { position: fixed; top: 20px; right: 20px; background: none; border: none; font-size: 28px; cursor: pointer; }
  </style>
</head>
<body>

<button id="muteBtn" onclick="toggleMute(this)">ğŸ”Š</button>
<h1>BJC Inventory List</h1>
<div style="text-align:center; margin: 10px 0;">
  <button onclick="exportJSON()">ğŸ“¥ Export Inventory JSON</button>
  <button onclick="document.getElementById('jsonFile').click()">ğŸ“‚ Import JSON</button>
  <input type="file" id="jsonFile" accept=".json" style="display: none;" onchange="importJSON(event)">
</div>

<table>
  <thead>
    <tr>
      <th>Barcode</th>
      <th>Name</th>
      <th>Price</th>
      <th>Quantity</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="product-table">
    <!-- Products will load here -->
  </tbody>
</table>

<script>
  // ğŸ”ˆ SOUND SUPPORT
  const successSnd = new Audio('sounds/success.mp3');
  const errorSnd = new Audio('sounds/error.mp3');
  let isMuted = false;

  function playSuccess() { if (!isMuted) successSnd.cloneNode().play(); }
  function playError()   { if (!isMuted) errorSnd.cloneNode().play(); }
  function toggleMute(btn) {
    isMuted = !isMuted;
    btn.textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
  }

  // ğŸ“¦ LOAD PRODUCTS
  function loadProducts() {
    const db = JSON.parse(localStorage.getItem('products') || '{}');
    const table = document.getElementById('product-table');
    table.innerHTML = ''; // clear

    for (const [barcode, product] of Object.entries(db)) {
      const qty = product.qty ?? 0;
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${barcode}</td>
        <td>${product.name}</td>
        <td>â‚±${parseFloat(product.price).toFixed(2)}</td>
        <td>${qty}</td>
        <td>
          <button class="edit-btn" onclick="editProduct('${barcode}')">âœï¸</button>
          <button class="del-btn" onclick="deleteProduct('${barcode}')">ğŸ—‘ï¸</button>
        </td>
      `;
      table.appendChild(row);
    }
  }

  // ğŸ—‘ï¸ DELETE
  function deleteProduct(barcode) {
    if (!confirm('âŒ Delete this product?')) return;
    const db = JSON.parse(localStorage.getItem('products') || '{}');
    delete db[barcode];
    localStorage.setItem('products', JSON.stringify(db));
    playSuccess();
    loadProducts();
  }

  // âœï¸ EDIT
  function editProduct(barcode) {
    const db = JSON.parse(localStorage.getItem('products') || '{}');
    const product = db[barcode];
    const newName = prompt('Edit name:', product.name);
    const newPrice = parseFloat(prompt('Edit price:', product.price));
    const newQty = parseInt(prompt('Edit quantity:', product.qty ?? 0));

    if (newName && !isNaN(newPrice) && !isNaN(newQty)) {
      db[barcode] = { ...product, name: newName, price: newPrice, qty: newQty };
      localStorage.setItem('products', JSON.stringify(db));
      playSuccess();
      loadProducts();
    } else {
      playError();
      alert('âš ï¸ Invalid input.');
    }
  }

  // ğŸ“ EXPORT JSON
  function exportJSON() {
    const db = localStorage.getItem('products');
    const blob = new Blob([db], { type: 'application/json' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'inventory.json';
    link.click();
  }

  // ğŸ“¥ IMPORT JSON
  function importJSON(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      try {
        const json = JSON.parse(e.target.result);
        localStorage.setItem('products', JSON.stringify(json));
        playSuccess();
        loadProducts();
      } catch {
        playError();
        alert('âŒ Invalid JSON file');
      }
    };
    reader.readAsText(file);
  }

  // ğŸš€ INIT (load from products.json)
  fetch("data/products.json")
    .then(res => res.json())
    .then(json => {
      localStorage.setItem("products", JSON.stringify(json));
      loadProducts();
    })
    .catch(err => {
      console.warn("âš ï¸ Failed to load products.json, using localStorage instead.");
      loadProducts();
    });
</script>
</body>
</html>
